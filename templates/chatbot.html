{% extends 'base.html' %}

{% block title %}Chatbot Assistant - Project Portal{% endblock %}

{% block extra_css %}
<style>
    .chat-container {
        height: 500px;
        overflow-y: auto;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
    }
    .chat-message {
        margin-bottom: 15px;
        padding: 10px 15px;
        border-radius: 1rem;
        max-width: 80%;
    }
    .user-message {
        background-color: #e9ecef;
        margin-left: auto;
        border-bottom-right-radius: 0;
    }
    .bot-message {
        background-color: #cfe2ff;
        margin-right: auto;
        border-bottom-left-radius: 0;
    }
    .message-time {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 5px;
    }
    .suggestions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }
    .suggestion-chip {
        cursor: pointer;
        padding: 5px 10px;
        background-color: #e9ecef;
        border-radius: 1rem;
        font-size: 0.875rem;
        transition: background-color 0.2s;
    }
    .suggestion-chip:hover {
        background-color: #dee2e6;
    }
</style>
{% endblock %}

{% block content %}
<div class=&quot;row mb-4&quot;>
    <div class=&quot;col-md-8&quot;>
        <h1 class=&quot;mb-2&quot;>Chatbot Assistant</h1>
        <p class=&quot;text-muted&quot;>Ask questions about your tasks and projects</p>
    </div>
</div>

<div class=&quot;row&quot;>
    <div class=&quot;col-lg-8 col-md-10 mx-auto&quot;>
        <div class=&quot;card shadow-sm&quot;>
            <div class=&quot;card-header bg-primary text-white&quot;>
                <h5 class=&quot;mb-0&quot;>
                    <i class=&quot;fas fa-robot me-2&quot;></i>Project Assistant
                </h5>
            </div>
            <div class=&quot;card-body p-0&quot;>
                <div class=&quot;chat-container&quot; id=&quot;chat-container&quot;>
                    <div class=&quot;chat-message bot-message&quot;>
                        <div>Hello, {{ current_user.username }}! I'm your project assistant. How can I help you today?</div>
                        <div class=&quot;message-time&quot;>Just now</div>
                    </div>
                </div>
            </div>
            <div class=&quot;card-footer&quot;>
                <div class=&quot;suggestions&quot;>
                    <div class=&quot;suggestion-chip&quot; onclick=&quot;sendSuggestion('How many tasks do I have?')&quot;>How many tasks do I have?</div>
                    <div class=&quot;suggestion-chip&quot; onclick=&quot;sendSuggestion('What are my tasks?')&quot;>What are my tasks?</div>
                    <div class=&quot;suggestion-chip&quot; onclick=&quot;sendSuggestion('What projects am I working on?')&quot;>What projects am I working on?</div>
                    <div class=&quot;suggestion-chip&quot; onclick=&quot;sendSuggestion('Who is assigned to tasks I created?')&quot;>Who is assigned to tasks I created?</div>
                </div>
                <div class=&quot;input-group mt-3&quot;>
                    <input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;message-input&quot; placeholder=&quot;Type your question here...&quot;>
                    <button class=&quot;btn btn-primary&quot; id=&quot;send-button&quot;>
                        <i class=&quot;fas fa-paper-plane&quot;></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
const chatContainer = document.getElementById('chat-container');
const messageInput = document.getElementById('message-input');
const sendButton = document.getElementById('send-button');
// Function to add a message to the chat
function addMessage(message, isUser = false) {
const messageDiv = document.createElement('div');
messageDiv.className = chat-message ${isUser ? 'user-message' : 'bot-message'};
const messageContent = document.createElement('div');
messageContent.textContent = message;
const messageTime = document.createElement('div');
messageTime.className = 'message-time';
messageTime.textContent = 'Just now';
messageDiv.appendChild(messageContent);
messageDiv.appendChild(messageTime);
chatContainer.appendChild(messageDiv);
// Scroll to bottom
chatContainer.scrollTop = chatContainer.scrollHeight;
}
// Function to send a message to the chatbot API
function sendMessage(message) {
// Add user message to chat
addMessage(message, true);
// Clear input
messageInput.value = '';
// Show loading indicator
const loadingDiv = document.createElement('div');
loadingDiv.className = 'chat-message bot-message';
loadingDiv.innerHTML = '<div><i class=&quot;fas fa-spinner fa-spin&quot;></i> Thinking...</div>';
chatContainer.appendChild(loadingDiv);
chatContainer.scrollTop = chatContainer.scrollHeight;
// Send message to API
fetch('/chatbot/query', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ query: message }),
})
.then(response => {
if (!response.ok) {
throw new Error('Failed to get response from chatbot');
}
return response.json();
})
.then(data => {
// Remove loading indicator
chatContainer.removeChild(loadingDiv);
// Add bot response to chat
addMessage(data.response);
})
.catch(error => {
console.error('Error sending message:', error);
// Remove loading indicator
chatContainer.removeChild(loadingDiv);
// Add error message
addMessage('Sorry, I encountered an error processing your request. Please try again.');
});
}
// Event listener for send button
sendButton.addEventListener('click', function() {
const message = messageInput.value.trim();
if (message) {
sendMessage(message);
}
});
// Event listener for Enter key
messageInput.addEventListener('keypress', function(e) {
if (e.key === 'Enter') {
const message = messageInput.value.trim();
if (message) {
sendMessage(message);
}
}
});
// Function to handle suggestion clicks
window.sendSuggestion = function(suggestion) {
messageInput.value = suggestion;
sendMessage(suggestion);
};
});
</script>
{% endblock %}
{% endblock %}